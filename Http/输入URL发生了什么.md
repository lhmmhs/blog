1. ##### DNS解析
2. ##### TCP3次握手，打开链接

* 第一次握手：客户端发送请求报文SYN=1，自己的初始化序列号seq=x，进入SYN_SENT（同步已发送状态）状态。
* 第二次握手：服务器收到报文后，发送确认报文ACK=1，SYN=1，确认号ack=x+1，自己的初始化序列号seq=y，进入SYN-RCVD（同步收到）状态。
* 第三次握手：客户端收到服务器的报文后，发送确认报文ACK=1，确认号ack=y+1，自己的序列号seq=x+1，客户端进入ESTABLISHED（已建立连接）状态，服务器收到报文后，进入ESTABLISHED（已建立连接）状态，完成三次握手。

| 字段 | 含义                                                         |
| :-------- | ------------------------------------------------------------ |
| ACK       | 连接建立状态的标志，为1便是确认连接。                |
| SYN       | 在连接建立时用来同步序号。当SYN=1，ACK=0，表明是连接请求报文，若同意连接，则响应报文中应该使SYN=1，ACK=1； |
| 确认号ack | 确认编号(Acknowledgement Number)，即接收到的上一次远端主机传来的seq然后+1，再发送给远端主机。提示远端主机已经成功接收上一次所有数据。 |
| 序列号seq | 是这个报文段中的第一个字节的数据编号。用来标记数据段的顺序。 |

3. ##### 发送HTTP请求

4. ##### 服务器响应请求

5. ##### 浏览器解析html

* 解析html，构建DOM树

* 解析css，构建CSS规则树
* 合并DOM树和CSS规则树为render树
* 布局render树，计算元素尺寸，位置

* 绘制render树

6. ##### TCP4次挥手，断开链接

* 第一次挥手，客户端发送释放报文FIN=1，自己的序列号seq=u，进入FIN-WAIT-1（终止等待1）状态。
* 第二次挥手，服务器收到释放报文后，发出确认报文ACK=1，确认号ack=u+1，自己的序列号seq=v，服务端就进入了CLOSE-WAIT（关闭等待）状态。**这时候处于半关闭状态，即客户端已经没有数据要发送了，但是服务器若发送数据，客户端依然要接受**。
* 客户端接收到确认报文后，进入FIN-WAIT-2（终止等待2）状态，**这时服务器发送的最后的数据**。
* 第三次挥手，服务器将最后的数据发送完毕后，就向客户端发送连接释放报文FIN=1，ACK=1，确认号ack=u+1，自己的序列号seq=w，服务器就进入了LAST-ACK（最后确认）状态，等待客户端的确认。
* 第四次挥手，客户端接收到释放报文后，发出确认报文ACK=1，确认号ack=w+1，自己的序列号seq=u+1，客户端就进入了TIME-WAIT（时间等待）状态。
* 服务器只要收到了客户端发出的确认，立即进入CLOSED状态。

| 字段 | 含义                                                         |
| ---- | ------------------------------------------------------------ |
| FIN  | 用来释放连接。当FIN=1，表明此报文的发送方的数据已经发送完毕，并且要求释放； |

#### 为什么采用三次握手

浏览器发出的连接请求报文，由于网络的原因滞留了。延误到连接释放以后才到达服务器，这本来是失效的的报文，但服务器误认为是浏览器发送的连接请求，于是就发送了确认报文，同意建立连接。

假设采用两次握手，由于浏览器没有发送请求报文，不会处理服务器发送的确认报文，但服务器已经建立了新的连接，并一直等待浏览器发送数据，导致服务器资源被浪费。

采用三次握手的情况下，浏览器不会处理确认报文，就不向服务器发送确认报文，服务器收不到确认报文，就知道浏览器并没有要求建立连接，不会进行等待。

**TCP 需要 seq 序列号来做可靠重传或接收，而避免连接复用时无法分辨出 seq 是延迟或者是旧链接的 seq，因此需要三次握手来约定确定双方的 ISN（初始 seq 序列号）**。



#### 参考文章

1. [从输入URL到页面加载的过程？如何由一道题完善自己的前端知识体系！](https://segmentfault.com/a/1190000013662126)
2. [两张动图-彻底明白TCP的三次握手与四次挥手](https://blog.csdn.net/qzcsu/article/details/72861891)
3. [TCP 为什么是三次握手，而不是两次或四次？](https://www.zhihu.com/question/24853633)

