Cross-Site Scripting（跨站脚本攻击）简称 XSS，是一种代码注入攻击。攻击者通过在目标网站上注入恶意脚本，使之在用户的浏览器上运行。

XSS 的本质是：恶意代码未经过滤，与网站正常的代码混在一起；浏览器无法分辨哪些脚本是可信的，导致恶意脚本被执行。

###  XSS分类

#### 存储型

**攻击者提交恶意代码到数据库中**，用户访问网站，网站**响应中包含来自数据库的恶意字符串，受害者浏览器执行恶意脚本。**

这种攻击常见于带有用户保存数据的网站功能，如论坛发帖、商品评论、用户私信等。

#### 反射型

攻击者构造包含恶意代码的URL，发送给用户，并诱导用户点击，网站**响应中包含恶意字符串，受害者浏览器执行恶意脚本。**

**反射型 XSS 跟存储型 XSS 的区别是：存储型 XSS 的恶意代码存在数据库里，反射型 XSS 的恶意代码存在 URL 里。**

反射型 XSS 漏洞常见于通过 URL 传递参数的功能，如网站搜索、跳转等。

#### DOM型

攻击者构造包含恶意代码的URL，发送给用户，并诱导用户点击，网站**响应中不包含恶意字符串，受害者浏览器执行合法脚本，通过DOM操作插入了恶意脚本。**

DOM 型 XSS 跟前两种 XSS 的区别：DOM 型是前端导致的，存储型和反射型是服务器端所导致的。

###  预防XSS

#### 输入过滤

对于明确的输入类型，例如数字、URL、电话号码、邮件地址等等内容，进行输入过滤。

#### 预防反射型XSS和存储型XSS

上述两种XSS攻击都是服务端响应中包含了恶意代码，处理方案：

* 纯前端渲染，浏览器加载的静态页面不包含业务数据，执行JavaScript通过ajax加载业务数据，操作dom更新页面

* 对HTML做充分转义，后端采用合适的转义库，对插入HTML的入口进行转义

#### 预防 DOM 型 XSS 攻击

前端代码中，能**把字符串当做代码运行**的地方需要判断，例如：eval，定时器

#### CSP(Content Security Policy)

建立白名单，告诉浏览器哪些外部资源可以执行和加载。

#### http-only

禁止通过document.cookie获取cookie

### 参考文章

1. [前端安全系列（一）：如何防止XSS攻击？](https://juejin.cn/post/6844903685122703367)
2. [Excess XSS](https://excess-xss.com/)